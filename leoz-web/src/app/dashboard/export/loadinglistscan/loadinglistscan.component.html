<form [formGroup]="loadinglistscanForm" style="padding-top: 10px">
  <div class="ui-fluid">
    <div class="ui-g">
      <div class="ui-g-12 ui-lg-7" style="padding: 0;">
        <p-fieldset legend="{{'loadingcontrol' | translate}}">
          <div class="ui-g-12 ui-g-nopad" style="padding-top: 10px">
            <div class="ui-g-12 ui-lg-4 ui-g-nopad">
              <button pButton type="button" label="{{'newloadlist' | translate}}" (click)="newLoadlist()"
                      style="width:140px"></button>
            </div>
            <div class="ui-g-12 ui-lg-4 ui-g-nopad">
              {{'exportdate' | translate}}:
              {{exportdate}}
            </div>
            <div class="ui-g-12 ui-lg-4 ui-g-nopad">
              {{'payload' | translate}}:
              <input pInputText formControlName="payload" (change)="changePayload()" class="bgLightYellow"
                     style="width:98%;">
            </div>
          </div>
          <div class="ui-g-12 ui-g-nopad">
            <div class="ui-g-12 ui-lg-4 ui-g-nopad">
              <p-dropdown formControlName="selectloadlist" [options]="allLoadlistsWithEmptyFirstEntry"
                          optionLabel="loadinglistNo"
                          [style]="{'width': '140px'}"
                          (onChange)="selectLoadlist($event.value)"></p-dropdown>
            </div>
            <div class="ui-g-12 ui-lg-4 ui-g-nopad">
              {{'loadlist' | translate}}:
              {{activeLoadinglist.loadinglistNo}}
            </div>
            <div class="ui-g-12 ui-lg-4 ui-g-nopad"></div>
          </div>
        </p-fieldset>
      </div>

      <div class="ui-g-12 ui-lg-5" style="padding: 0;">
        <p-fieldset legend="{{'loadlist' | translate}}">
          <div class="ui-g-12 ui-lg-4 ui-g-nopad" style="padding-top: 10px">
            <div class="ui-g-12">
              <p-checkbox name="printlabel" value="printlabel" label="{{'printlabel' | translate}}"></p-checkbox>
            </div>
          </div>
          <div class="ui-g-12 ui-lg-4 ui-g-nopad" style="padding-top: 10px">
            <div class="ui-g-12">
              <p-radioButton name="basedon" value="alllists" formControlName="basedon"
                             label="{{'alllists' | translate}}"></p-radioButton>
            </div>
            <div class="ui-g-12">
              <p-radioButton name="basedon" value="actuallist" formControlName="basedon"
                             label="{{'actuallist' | translate}}"></p-radioButton>
            </div>
          </div>
          <div class="ui-g-12 ui-lg-4 ui-g-nopad" style="padding-top: 10px">
            <div *ngIf="notMicrodoof" class="ui-g-12">
              <button pButton type="button" (click)="preview()" label="{{'preview' | translate}}"></button>
            </div>
            <div class="ui-g-12">
              <button pButton type="button" (click)="saving()" label="{{'save' | translate}}"></button>
            </div>
          </div>
        </p-fieldset>
      </div>

      <div class="ui-g-12 ui-lg-4" style="padding:0;">
        <p-fieldset legend="{{'scanmsgfield' | translate}}">
          <div class="ui-g-12 ui-g-nopad inputField"
               style="height: 69px; padding-top: 15px; margin-bottom:5px; text-align: center; font-size: 30px">
            {{shortScanMsg | translate}}
          </div>
        </p-fieldset>
      </div>

      <div class="ui-g-12 ui-lg-8" style="padding: 0;">
        <p-fieldset legend="{{'scanfield' | translate}}">
          <input #scanfield pInputText formControlName="scanfield" (change)="scanSingleParcel()" class="bgLightYellow"
                 style="font-size: 40px; margin-bottom:5px; height: 100%">
        </p-fieldset>
      </div>

      <div class="ui-g-12 ui-lg-4" style="padding:0; border: 1px solid transparent !important;">
        <p-fieldset legend="{{'information' | translate}}">
          <div class="ui-g-12 ui-g-nopad" style="padding-top: 10px">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad bgLightYellow" style="border:1px solid darkgrey; padding-left: 4px;">
              {{'loadlistnumber' | translate}}:
            </div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">
              {{activeLoadinglist.loadinglistNo}}
            </div>
          </div>
          <div class="ui-g-12 ui-g-nopad" style="padding-top: 2px">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">{{'loadedweight' | translate}}:</div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">{{totalWeight}}</div>
          </div>
          <div class="ui-g-12 ui-g-nopad" style="padding-top: 2px">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">{{'freeweight' | translate}}:</div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad" [ngStyle]="styleWeightExceeded">
              {{freeWeight}}
            </div>
          </div>

          <div class="ui-g-12 ui-g-nopad">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad bgLightYellow" style="border:1px solid darkgrey; padding-left: 4px;">
              {{'stillopen' | translate}}:
            </div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad"></div>
          </div>

          <div class="ui-g-12 ui-g-nopad" style="padding-top: 2px">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">{{'packcount' | translate}}:</div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">
              {{openPackcount}}
            </div>
          </div>

          <div class="ui-g-12 ui-g-nopad" style="padding-top: 2px">
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">{{'weight' | translate}}:</div>
            <div class="ui-g-12 ui-lg-6 ui-g-nopad">
              {{openWeight}}
            </div>
          </div>
          <div class="ui-g-12 ui-g-nopad inputField bgLightYellow"
               style="padding: 5px; height:120px; overflow-y: scroll">
            <span *ngFor="let actionMsg of actionMsgList$ | async">
              {{actionMsg | translate}}<br>
            </span>
          </div>
          <div class="ui-g-12 ui-g-nopad inputField" [ngStyle]="styleScanMsgListBG"
               style="margin-top: 2px; padding: 5px; height:120px; overflow-y: scroll">
            <div *ngFor="let scanMsg of scanMsgs$ | async" style="padding-bottom:10px;">
              <span *ngIf="scanMsg.packageId.length > 0 && scanMsg.msgText.length > 0">
                {{scanMsg.packageId}}:
              </span>
              {{scanMsg.msgText | translate}}
            </div>
          </div>
        </p-fieldset>
      </div>
      <div class="ui-g-12 ui-lg-8" style="padding:0;">
        <p-fieldset id="fieldsetPackages" legend="{{'packages' | translate}}">
          <p-tabView>
            <p-tabPanel header="{{'notloaded' | translate}}">
              <p style="text-align: center">
                <p-progressBar *ngIf="scanInProgress; else infoTxt" [value]="scanProgress"></p-progressBar>
                <ng-template #infoTxt>
                  {{'notOnLoadlist' | translate}} {{openPackcount}}
                </ng-template>
              </p>
              <p-table [value]="openParcels$ | async" [responsive]="true"
                       [scrollable]="true" scrollHeight="250px"
                       selectionMode="multiple" [(selection)]="selectedParcels">
                <ng-template pTemplate="header">
                  <tr>
                    <th [pSortableColumn]="'parcelNo'" style="width:115px;">
                      {{'parcelno' | translate}}
                      <p-sortIcon [field]="'parcelNo'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'zip'">
                      {{'zip' | translate}}
                      <p-sortIcon [field]="'zip'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'realWeight'">
                      {{'weight' | translate}}
                      <p-sortIcon [field]="'realWeight'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'devliveryStation'">
                      {{'devliveryStation' | translate}}
                      <p-sortIcon [field]="'devliveryStation'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'typeOfPackaging'">
                      {{'valore' | translate}}
                      <p-sortIcon [field]="'typeOfPackaging'"></p-sortIcon>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-package let-columns="columns" let-rowIndex="rowIndex">
                  <tr [pSelectableRow]="package" [pSelectableRowIndex]="rowIndex">
                    <td style="width:115px;">{{package.parcelNo}}</td>
                    <td>{{package.zip}}</td>
                    <td>{{package.realWeight}}</td>
                    <td>{{package.devliveryStation}}</td>
                    <td>
                    <span *ngIf="isValuable(package); else noValuable">
                      {{ 'yes' | translate }}
                    </span>
                      <ng-template #noValuable>
                        {{ 'no' | translate }}
                      </ng-template>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td [attr.colspan]="6">
                      {{'noDataAvailable' | translate}}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabPanel>
            <p-tabPanel header="{{'loaded' | translate}}">
              <p style="text-align: center">{{'onLoadlist' | translate}} {{loadedPackcount}}</p>
              <p-table [value]="loadedParcels$ | async" [responsive]="true"
                       [scrollable]="true" scrollHeight="250px">
                <ng-template pTemplate="header">
                  <tr>
                    <th [pSortableColumn]="'parcelNo'" style="width:115px;">
                      {{'parcelno' | translate}}
                      <p-sortIcon [field]="'parcelNo'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'zip'">
                      {{'zip' | translate}}
                      <p-sortIcon [field]="'zip'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'realWeight'">
                      {{'weight' | translate}}
                      <p-sortIcon [field]="'realWeight'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'devliveryStation'">
                      {{'devliveryStation' | translate}}
                      <p-sortIcon [field]="'devliveryStation'"></p-sortIcon>
                    </th>
                    <th [pSortableColumn]="'typeOfPackaging'">
                      {{'valore' | translate}}
                      <p-sortIcon [field]="'typeOfPackaging'"></p-sortIcon>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-package>
                  <tr>
                    <td style="width:115px;">{{package.parcelNo}}</td>
                    <td>{{package.zip}}</td>
                    <td>{{package.realWeight}}</td>
                    <td>{{package.devliveryStation}}</td>
                    <td>
                    <span *ngIf="isValuable(package); else noValuable">
                      {{ 'yes' | translate }}
                    </span>
                      <ng-template #noValuable>
                        {{ 'no' | translate }}
                      </ng-template>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td [attr.colspan]="6">
                      {{'noDataAvailable' | translate}}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabPanel>
          </p-tabView>
        </p-fieldset>
      </div>
    </div>
  </div>
</form>
